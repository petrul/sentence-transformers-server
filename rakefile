task :default => :run do
end

task :run do |t|
    shell 'uvicorn src.simile.restapi:app  --port 11111  --reload'
end

task :unittest do |t|
    shell 'python3 -m unittest -v tests/*.py'
end

task :test => :pytest

# to select a specific testcase, use
# $ pytest tests/*.py -v -k inmem -rP
task :pytest do |t|
    shell 'pytest -m src src/**/*-test.py src/*-test.py -v -rP'
end

def shell(cmd)
    puts "#{cmd}"
    system "#{cmd}"
end

task :clean do
    # shell "rm -rf .pytest_cache"
    shell "find . -name .pytest_cache -type d -exec rm -rvf  \{\} \\;"
    shell "find . -name __pycache__ -type d -exec rm -rvf  \{\} \\;"
end
